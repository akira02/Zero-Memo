module.exports=function(t){var e={};function r(n){if(e[n])return e[n].exports;var o=e[n]={i:n,l:!1,exports:{}};return t[n].call(o.exports,o,o.exports,r),o.l=!0,o.exports}return r.m=t,r.c=e,r.d=function(t,e,n){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},r.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)r.d(n,o,function(e){return t[e]}.bind(null,o));return n},r.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="/",r(r.s="QfWi")}({HteQ:function(t,e){t.exports=require("preact")},QfWi:function(t,e,r){"use strict";r.r(e);var n,o,u,i=r("HteQ"),c=0,a=[],l=i.options.__b,s=i.options.__r,f=i.options.diffed,h=i.options.__c,_=i.options.unmount;function b(t,e){i.options.__h&&i.options.__h(o,t,c||e),c=0;var r=o.__H||(o.__H={__:[],__h:[]});return t>=r.__.length&&r.__.push({}),r.__[t]}function m(t){return c=1,function(t,e,r){var u=b(n++,2);return u.t=t,u.__c||(u.__=[r?r(e):j(void 0,e),function(t){var e=u.t(u.__[0],t);u.__[0]!==e&&(u.__=[e,u.__[1]],u.__c.setState({}))}],u.__c=o),u.__}(j,t)}function p(t,e){var r=b(n++,7);return T(r.__H,e)&&(r.__=t(),r.__H=e,r.__h=t),r.__}function d(){a.forEach((function(t){if(t.__P)try{t.__H.__h.forEach(E),t.__H.__h.forEach(O),t.__H.__h=[]}catch(e){t.__H.__h=[],i.options.__e(e,t.__v)}})),a=[]}i.options.__b=function(t){o=null,l&&l(t)},i.options.__r=function(t){s&&s(t),n=0;var e=(o=t.__c).__H;e&&(e.__h.forEach(E),e.__h.forEach(O),e.__h=[])},i.options.diffed=function(t){f&&f(t);var e=t.__c;e&&e.__H&&e.__H.__h.length&&(1!==a.push(e)&&u===i.options.requestAnimationFrame||((u=i.options.requestAnimationFrame)||function(t){var e,r=function(){clearTimeout(n),g&&cancelAnimationFrame(e),setTimeout(t)},n=setTimeout(r,100);g&&(e=requestAnimationFrame(r))})(d)),o=void 0},i.options.__c=function(t,e){e.some((function(t){try{t.__h.forEach(E),t.__h=t.__h.filter((function(t){return!t.__||O(t)}))}catch(r){e.some((function(t){t.__h&&(t.__h=[])})),e=[],i.options.__e(r,t.__v)}})),h&&h(t,e)},i.options.unmount=function(t){_&&_(t);var e=t.__c;if(e&&e.__H)try{e.__H.__.forEach(E)}catch(t){i.options.__e(t,e.__v)}};var g="function"==typeof requestAnimationFrame;function E(t){var e=o;"function"==typeof t.__c&&t.__c(),o=e}function O(t){var e=o;t.__c=t.__(),o=e}function T(t,e){return!t||t.length!==e.length||e.some((function(e,r){return e!==t[r]}))}function j(t,e){return"function"==typeof e?e(t):e}const v="/* ==== BEGIN CONFIGURATION ==== */";const R=new DataView(new ArrayBuffer(8));function y(t){const e=t>=0?1:-1;if(t=Math.abs(t),isNaN(t))return NaN;if(t===1/0)return 1*e;R.setFloat64(0,t);const r=R.getInt32(0);if(r<1072365568){if(r<1043333120)return r<8388608?e*(.125*(8*t+1.0270333367641007*t)):e*(t+.1283791670955126*t);const n=t*t;return e*(t+t*((.12837916709551256+n*(n*(n*(-23763016656650163e-21*n-.005770270296489442)-.02848174957559851)-.3250421072470015))/(1+n*(.39791722395915535+n*(.0650222499887673+n*(.005081306281875766+n*(.00013249473800432164+-3960228278775368e-21*n)))))))}if(r<1072955392){const r=t-1;return e*(.8450629115104675+(r*(.41485611868374833+r*(r*(.31834661990116175+r*(r*(.035478304325618236+-.002166375594868791*r)-.11089469428239668))-.3722078760357013))-.0023621185607526594)/(1+r*(.10642088040084423+r*(.540397917702171+r*(.07182865441419627+r*(.12617121980876164+r*(.01363708391202905+.011984499846799107*r)))))))}if(r>=1075314688)return 1*e;const n=1/(t*t);let o,u;r<1074191214?(o=n*(n*(n*(n*(n*(n*(-9.814329344169145*n-81.2874355063066)-184.60509290671104)-162.39666946257347)-62.375332450326006)-10.558626225323291)-.6938585727071818)-.009864944034847148,u=1+n*(19.651271667439257+n*(137.65775414351904+n*(434.56587747522923+n*(645.3872717332679+n*(429.00814002756783+n*(108.63500554177944+n*(6.570249770319282+-.0604244152148581*n)))))))):(o=n*(n*(n*(n*(n*(-483.5191916086514*n-1025.0951316110772)-637.5664433683896)-160.63638485582192)-17.757954917754752)-.799283237680523)-.0098649429247001,u=1+n*(30.33806074348246+n*(325.7925129965739+n*(1536.729586084437+n*(3199.8582195085955+n*(2553.0504064331644+n*(474.52854120695537+-22.44095244658582*n))))))),R.setInt32(4,0);const i=R.getFloat64(0);return e*(1-Math.exp(-i*i-.5625)*Math.exp((i-t)*(i+t)+o/u)/t)}function P(t,e){const r=y((t-.5)/(e*Math.SQRT2));return(y((t+.5)/(e*Math.SQRT2))-r)/2}function U(t){return["\n    precision highp float;\n    attribute vec2 a_position;\n    void main() {\n      gl_Position = vec4(a_position, 0.0, 1.0);\n    }\n  ",`\n    precision mediump float;\n    uniform sampler2D u_texture;\n    uniform highp vec2 u_shape;\n    uniform highp vec2 u_blurDirection;\n    uniform vec4 u_mixColor;\n    void main() {\n      gl_FragColor = vec4(0.0);\n      ${function(t){const e=[];e.push({offset:0,weight:P(0,t)});const r=Math.ceil(3*t);for(let n=1;n<=r;n+=2){const r=P(n,t),o=P(n+1,t),u=(r*n+o*(n+1))/(r+o),i=r+o;e.push({offset:u,weight:i}),e.push({offset:-u,weight:i})}return e}(t.blur).map(({offset:t,weight:e})=>`gl_FragColor += texture2D(u_texture, ${`(gl_FragCoord.xy + u_blurDirection * ${t.toExponential()}) / u_shape`}) * ${e.toExponential()};`).join("\n")}\n      gl_FragColor = vec4(mix(gl_FragColor.rgb, u_mixColor.rgb, u_mixColor.a), 1.0);\n    }\n  `]}const x=new Float32Array([-1,1,-1,-1,1,1,1,1,-1,-1,1,-1]);function A(t,e){const{width:r,height:n}=t,o=document.createElement("canvas");o.width=r,o.height=n;const u=o.getContext("webgl",{depth:!1,antialias:!1});u.pixelStorei(u.UNPACK_FLIP_Y_WEBGL,!0);const i=u.createBuffer();u.bindBuffer(u.ARRAY_BUFFER,i),u.bufferData(u.ARRAY_BUFFER,x,u.STATIC_DRAW);const c=u.createTexture();u.bindTexture(u.TEXTURE_2D,c),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MAG_FILTER,u.LINEAR),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MIN_FILTER,u.LINEAR),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_S,u.CLAMP_TO_EDGE),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_T,u.CLAMP_TO_EDGE),u.texImage2D(u.TEXTURE_2D,0,u.RGBA,u.RGBA,u.UNSIGNED_BYTE,t);const a=u.createTexture();u.bindTexture(u.TEXTURE_2D,a),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MAG_FILTER,u.LINEAR),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MIN_FILTER,u.LINEAR),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_S,u.CLAMP_TO_EDGE),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_T,u.CLAMP_TO_EDGE),u.texImage2D(u.TEXTURE_2D,0,u.RGBA,r,n,0,u.RGBA,u.UNSIGNED_BYTE,null);const l=u.createFramebuffer();u.bindFramebuffer(u.FRAMEBUFFER,l),u.framebufferTexture2D(u.FRAMEBUFFER,u.COLOR_ATTACHMENT0,u.TEXTURE_2D,a,0);const[s,f]=U(e),h=u.createShader(u.VERTEX_SHADER);u.shaderSource(h,s),w(u,h);const _=u.createShader(u.FRAGMENT_SHADER);u.shaderSource(_,f),w(u,_);const b=u.createProgram();u.attachShader(b,h),u.attachShader(b,_),function(t,e){t.linkProgram(e);if(!t.getProgramParameter(e,t.LINK_STATUS))throw new Error(t.getProgramInfoLog(e))}(u,b),u.useProgram(b);const m=u.getAttribLocation(b,"a_position"),p=u.getUniformLocation(b,"u_texture"),d=u.getUniformLocation(b,"u_shape"),g=u.getUniformLocation(b,"u_blurDirection"),E=u.getUniformLocation(b,"u_mixColor");return u.enableVertexAttribArray(m),u.bindBuffer(u.ARRAY_BUFFER,i),u.vertexAttribPointer(m,2,u.FLOAT,!1,0,0),u.activeTexture(u.TEXTURE0),u.uniform1i(p,0),u.uniform2fv(d,[r,n]),u.bindFramebuffer(u.FRAMEBUFFER,l),u.bindTexture(u.TEXTURE_2D,c),u.uniform2fv(g,[1,0]),u.uniform4fv(E,[0,0,0,0]),u.drawArrays(u.TRIANGLES,0,6),u.bindFramebuffer(u.FRAMEBUFFER,null),u.bindTexture(u.TEXTURE_2D,a),u.uniform2fv(g,[0,1]),u.uniform4fv(E,e.mixColor),u.drawArrays(u.TRIANGLES,0,6),new Promise(t=>{o.toBlob(t,"image/jpeg")})}function w(t,e){t.compileShader(e);if(!t.getShaderParameter(e,t.COMPILE_STATUS))throw new Error(t.getShaderInfoLog(e));return e}function F(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function D(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?F(Object(r),!0).forEach((function(e){L(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):F(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}function L(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function S({defaultType:t="url",name:e}){const[r,n]=m(t);return Object(i.h)("div",{class:"form-group"},Object(i.h)("div",{class:"input-group"},Object(i.h)("span",{class:"input-group-btn"},Object(i.h)("select",{name:e+"-type",class:"btn",value:r,onChange:t=>n(t.target.value)},Object(i.h)("option",{value:"url"},"URL"),Object(i.h)("option",{value:"file"},"檔案/ファイル"))),Object(i.h)("input",{type:r,name:e,class:"form-control",required:"required"})))}function I(t,e){return{type:t.get(e+"-type"),value:t.get(e)}}function C({name:t,defaultBlur:e,defaultBrightness:r}){return Object(i.h)("div",{class:"form-group"},Object(i.h)("label",null,"亮度 明るさを調整"),Object(i.h)("input",{type:"range",name:t+"-brightness",min:"-100",max:"100",defaultValue:r}),Object(i.h)("label",null,"模糊 ぼかし"),Object(i.h)("input",{type:"range",name:t+"-blur",min:"0",max:"1000",defaultValue:e}))}function k(t,e){const r=parseInt(t.get(e+"-brightness"))/100;return{blur:parseInt(t.get(e+"-blur"))/100,mixColor:r>0?[1,1,1,r]:[0,0,0,-r]}}function M({onSubmit:t}){return Object(i.h)(i.Fragment,null,Object(i.h)("h2",null,"Step.1 設定"),Object(i.h)("span",null,"先選擇你要的背景圖，設定好你喜歡的明暗透明度、模糊程度並預覽"),Object(i.h)("form",{onSubmit:e=>{e.preventDefault();const r=new FormData(e.target);t({image:I(r,"image-input"),options:{dashboard:k(r,"dashboard"),plurk:k(r,"plurk")}})}},Object(i.h)("h3",null,"背景画像選択"),Object(i.h)(S,{name:"image-input"}),Object(i.h)("h3",null,"資訊面板黑背景 深い色の背景"),Object(i.h)(C,{name:"dashboard",defaultBrightness:"-50",defaultBlur:"300"}),Object(i.h)("h3",null,"噗文白背景 淡い色の背景"),Object(i.h)(C,{name:"plurk",defaultBrightness:"70",defaultBlur:"300"}),Object(i.h)("button",{type:"submit",class:"btn btn-primary"},"預覽設定プレビュー！")))}function B({images:t}){return Object(i.h)(i.Fragment,null,Object(i.h)("h2",null,"Step.2 預覽 プレビュー"),Object(i.h)("div",{class:"preview background-timeline",style:t?`background-image: url(${t.timeline.objectURL})`:""},Object(i.h)("div",{class:"preview-box background-dashboard",style:t?`background-image: url(${t.dashboard.objectURL})`:""},"側邊欄",Object(i.h)("br",null),Object(i.h)("br",null),"統計",Object(i.h)("br",null),"朋友",Object(i.h)("br",null),"粉絲"),Object(i.h)("div",{class:"preview-box background-plurk",style:t?`background-image: url(${t.plurk.objectURL})`:""},Object(i.h)("b",null,"千秋"),Object(i.h)("span",{class:"say"},Object(i.h)("b",null,"說")),"你好，謝謝你的使用OwO")))}function N({images:t,onDone:e}){const[r,n]=m(!1),o=null!=t&&!r;return Object(i.h)(i.Fragment,null,Object(i.h)("button",{type:"button",class:"btn btn-primary",onClick:()=>new Promise((function(r,u){var i=function(t){return function(e){try{return n(!1),t&&t.call(this,e)}catch(t){return u(t)}}.bind(this)}.bind(this);if(!o)return r();n(!0);var c=function(){try{return r()}catch(t){return u(t)}},a=function(t){try{return console.error(t),alert("上傳失敗"),i(c)()}catch(t){return i(u)(t)}};try{let r;return r={},Promise.resolve(Promise.all(Object.keys(t).map(e=>new Promise((function(n,o){return Promise.resolve((u=t[e].blob,new Promise((function(t,e){let r,n,o;return r=new FormData,r.append("image",u),Promise.resolve(fetch("https://api.imgur.com/3/image.json",{method:"POST",headers:{Authorization:"Client-ID f28cb80465f9e25"},body:r})).then((function(r){try{return n=r,Promise.resolve(n.json()).then((function(r){try{return o=r,o.success?t(o.data.link):e(new Error(o.data.error))}catch(t){return e(t)}}),e)}catch(t){return e(t)}}),e)})))).then((function(t){try{return r[e]=t,n()}catch(t){return o(t)}}),o);var u}))))).then((function(t){try{return e(r),i(c)()}catch(t){return a(t)}}),a)}catch(t){a(t)}})),disabled:!o},"確認產生CSS"),Object(i.h)("span",null,"画像をアップロードする、少々お待ちください((要等蠻久的，好了我會彈個提示"))}function X({css:t}){const e=(r=null,c=5,p((function(){return{current:r}}),[]));var r;return Object(i.h)(i.Fragment,null,Object(i.h)("h2",null,"領取CSS"),Object(i.h)("textarea",{ref:e,class:"form-control",style:"max-height: 500px"},t),Object(i.h)("button",{type:"button",class:"btn btn-default",onClick:()=>{e.current.select(),document.execCommand("copy")}},"點我複製"),Object(i.h)("span",null,"コピーする！"))}function G(t){return new Promise((function(e,r){let n,o,u,i;return Promise.resolve(function({type:t,value:e}){return new Promise((function(r,n){return"url"===t?r(fetch(e,{mode:"cors"}).then(t=>t.blob())):"file"===t?r(e):r()}))}(t.image)).then((function(c){try{return n=c,Promise.resolve((a=n,new Promise((function(t,e){var r=function(t){return function(r){try{return URL.revokeObjectURL(n),t&&t.call(this,r)}catch(t){return e(t)}}.bind(this)}.bind(this);let n;n=URL.createObjectURL(a);var o=function(t){try{throw t}catch(t){return r(e)(t)}};try{let e;return e=new Image,e.decode?(e.src=n,Promise.resolve(e.decode()).then(function(t){try{return u.call(this)}catch(t){return o(t)}}.bind(this),o)):Promise.resolve(new Promise((t,r)=>{e.onload=t,e.onerror=r,e.src=n})).then(function(t){try{return u.call(this)}catch(t){return o(t)}}.bind(this),o);function u(){return r(t)(e)}}catch(t){o(t)}})))).then((function(c){try{return o=c,u=Math.min(o.width,o.height)/200,i={},i.timeline={blob:n,objectURL:URL.createObjectURL(n)},Promise.resolve(Promise.all(["dashboard","plurk"].map(e=>new Promise((function(r,n){let c,a;return c=t.options[e],Promise.resolve(A(o,D(D({},c),{},{blur:c.blur*u}))).then((function(t){try{return a=t,i[e]={blob:a,objectURL:URL.createObjectURL(a)},r()}catch(t){return n(t)}}),n)}))))).then((function(t){try{return e(i)}catch(t){return r(t)}}),r)}catch(t){return r(t)}}),r)}catch(t){return r(t)}var a}),r)}))}e.default=function(){const[t,e]=m(null),[r,n]=m("");return Object(i.h)("div",{class:"container"},Object(i.h)("h1",null,"Zero-Memo模糊背景產生器·改",Object(i.h)("small",null,"beta")),Object(i.h)("hr",null),Object(i.h)("div",{class:"row"},Object(i.h)("div",{class:"col-md-6"},Object(i.h)(M,{onSubmit:t=>new Promise((function(r,o){var u=function(){try{return r()}catch(t){return o(t)}},i=function(t){try{return console.error(t),alert("☆生☆成☆大☆失☆敗☆"),u()}catch(t){return o(t)}};try{let r;return n(""),Promise.resolve(G(t)).then((function(t){try{return r=t,e(t=>(function(t){if(null!=t)for(const e in t)URL.revokeObjectURL(t[e].objectURL)}(t),r)),alert("好惹"),u()}catch(t){return i(t)}}),i)}catch(t){i(t)}}))})),Object(i.h)("div",{class:"col-md-6"},Object(i.h)(B,{images:t}),Object(i.h)(N,{images:t,onDone:t=>new Promise((function(e,r){let o;return Promise.resolve(new Promise((function(t,e){return t(fetch("https://raw.githubusercontent.com/akira02/Zero-Memo/master/plurk.css").then(t=>t.text()))}))).then((function(u){try{return o=u,n(function(t,e){const r=t.indexOf(v);if(-1==r)throw new Error("prefix string not found");const n=t.indexOf("/* ==== END CONFIGURATION ==== */",r+v.length);if(-1==n)throw new Error("suffix string not found");const o=function(t){return`\nbody {\n    /* △未模糊背景圖片 */\n    --background-image-timeline: url(${t.timeline});\n    /* ☆白色模糊背景圖片 */\n    --background-image-plurk: url(${t.plurk});\n    /* ★黑色模糊背景圖片 */\n    --background-image-dashboard: url(${t.dashboard});\n}\n`}(e);return t.slice(0,r+v.length)+o+t.slice(n)}(o,t)),e()}catch(t){return r(t)}}),r)}))}),Object(i.h)(X,{css:r}),Object(i.h)("a",{href:"https://www.plurk.com/akira02/invite/4",class:"btn btn-outline-danger",role:"button"},"喜歡請追蹤千秋的噗浪<3",Object(i.h)("br",null),"フォローしてください"))))}}});
//# sourceMappingURL=ssr-bundle.js.map